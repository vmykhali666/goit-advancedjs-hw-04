{"version":3,"file":"commonHelpers.js","sources":["../src/js/pixabayService.js","../src/main.js"],"sourcesContent":["import axios from \"axios\";\n\nexport class PixabayService {\n    #key = \"41115082-57084d131d6361bf0a1460296\";\n    #baseUrl = \"https://pixabay.com/api/\";\n    pageCount = 1;\n    perPage = 40;\n\n    async fetchImages(queryText) {\n        \n        let parameters = {\n            key : this.#key,\n            q: queryText,\n            image_type : \"photo\",\n            orientation : \"horizontal\",\n            safesearch : \"true\",\n            page : this.pageCount,\n            per_page : this.perPage\n        };\n\n        let requestUrl = this.#createRequestURL(parameters);\n        return await axios.get(requestUrl).then(responce => {\n            console.log(this.pageCount);\n            return responce.data;\n        });\n    }\n\n    resetPageCount() {\n        this.pageCount = 1;\n    }\n\n    #createRequestURL(params) {\n        return this.#baseUrl + \"?\" + new URLSearchParams(params);\n    }\n\n    incrementPageCount() {\n        this.pageCount++;\n    }\n}","import { PixabayService } from \"./js/pixabayService.js\"\nimport iziToast from 'izitoast';\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\nimport 'izitoast/dist/css/iziToast.min.css';\n\nconst form = document.querySelector(\".search-form\");\nconst gallery = document.querySelector(\".gallery\");\nconst searchInput = form.elements.searchQuery;\nconst pixabayService = new PixabayService();\n\nlet requestMessage = \"\";\nlet activeScroll = true;\nlet isLoading = false;\n\nfunction showError(message) {\n    iziToast.show({\n        title: 'Error',\n        message: `❌ Oops! ${message}`,\n        position: 'topRight',\n        color: 'red',\n    });\n}\n\nfunction setScroll() {\n    const { height: cardHeight } = document\n        .querySelector(\".gallery\")\n        .firstElementChild.getBoundingClientRect();\n\n    window.scrollBy({\n        top: cardHeight * 2,\n        behavior: \"smooth\",\n    });\n}\n\nfunction isScrollAtEnd() {\n    const content = document.querySelector('body');\n    return window.innerHeight + window.scrollY >= content.offsetHeight;\n}\n\nasync function handleScroll() {\n    if (isScrollAtEnd()) {\n        if (!activeScroll) {\n            showMessage(\"We're sorry, but you've reached the end of search results.\");\n        }\n        else if (!isLoading) {\n            await fetchPhotos();\n            setScroll();\n        }\n    }\n}\n\n\nfunction showMessage(message) {\n    iziToast.show({\n        title : 'OK',\n        message : `✅ Done! ${message}`,\n        position: 'topRight',\n        color : 'green'\n    });\n}\n\nfunction showSuccess(message) {\n    iziToast.success({\n      title: 'Success',\n      message: message,\n      position: 'topRight',\n      color: 'green',\n    });\n}\n\nasync function fetchPhotos() {\n    try {\n        const data = await pixabayService.fetchImages(requestMessage);\n        pixabayService.incrementPageCount();\n\n        isLoading = true;\n        activeScroll = true;\n        if (!data.hits.length) {\n            throw new Error(\"Sorry, there are no images matching your search query. Please try again.\");\n        }\n\n        if ((pixabayService.pageCount - 1) * pixabayService.perPage >= data.totalHits) {\n            activeScroll = false;\n        }\n        \n        if (!pixabayService.pageCount > 1) {\n            showSuccess(`Hooray! We found ${data.totalHits} totalHits images.`);\n        }\n        \n        const markup = data.hits.map(createMarkup).join(\"\");\n\n        gallery.insertAdjacentHTML(\"beforeend\", markup);\n\n        const modal = new SimpleLightbox('.gallery a');\n    }\n    catch (error) {\n        resetGalley();\n        showError(error);\n    }\n    finally {\n        isLoading = false;\n    }\n}\n\nfunction createMarkup(matchElement) {\n    return `<div class=\"photo-card\">\n                <a class=\"card-link\" href=\"${matchElement.largeImageURL}\">\n                    <img class=\"card-img\" src=\"${matchElement.webformatURL}\" alt=\"${matchElement.tags}\" loading=\"lazy\" />\n                </a>\n                <div class=\"info\">\n                    <p class=\"info-item\">\n                        <b>Likes</b>\n                        <span>${matchElement.likes}</span>\n                    </p>\n                    <p class=\"info-item\">\n                        <b>Views</b>\n                        <span>${matchElement.views}</span>\n                    </p>\n                    <p class=\"info-item\">\n                        <b>Comments</b>\n                        <span>${matchElement.comments}</span>\n                    </p>\n                    <p class=\"info-item\">\n                        <b>Downloads</b>\n                        <span>${matchElement.downloads}</span>\n                    </p>\n                </div>\n            </div>`\n}\n\nfunction resetGalley () {\n    pixabayService.resetPageCount();\n    // hideLoadMore();\n    gallery.innerHTML = \"\";\n    window.removeEventListener('scroll', handleScroll);\n}\n\nasync function onFormSubmit(event) {\n    try {\n        event.preventDefault();\n        resetGalley();\n        const tempRequest = searchInput.value.trim();\n        if (tempRequest === \"\") {\n            throw new Error(\"Sorry, we can`t handle empty request, please enter the query\");\n        }\n        requestMessage = tempRequest;\n        await fetchPhotos();\n\n        window.addEventListener('scroll', handleScroll);\n    } catch (error) {\n        showError(error);\n    }\n}\n\nform.addEventListener(\"submit\", onFormSubmit)\n\n"],"names":["PixabayService","__privateAdd","_createRequestURL","_key","_baseUrl","__publicField","queryText","parameters","__privateGet","requestUrl","__privateMethod","createRequestURL_fn","axios","responce","params","form","gallery","searchInput","pixabayService","requestMessage","activeScroll","isLoading","showError","message","iziToast","setScroll","cardHeight","isScrollAtEnd","content","handleScroll","fetchPhotos","showMessage","showSuccess","data","markup","createMarkup","modal","SimpleLightbox","error","resetGalley","matchElement","onFormSubmit","event","tempRequest"],"mappings":"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"}